
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KPIダッシュボード</title>

<style>

body{
font-family:-apple-system,BlinkMacSystemFont;
background:#f4f4f4;
margin:0;
padding:20px;
}

.card{
background:white;
padding:16px;
margin-bottom:16px;
border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

h2{
margin-top:0;
}

label{
display:block;
margin-top:10px;
}

input,select{
width:100%;
padding:10px;
margin-top:4px;
border-radius:8px;
border:1px solid #ccc;
box-sizing:border-box;
}

.checkbox{
display:flex;
align-items:center;
gap:8px;
margin-top:10px;
}

button{
width:100%;
padding:14px;
margin-top:12px;
background:black;
color:white;
border:none;
border-radius:10px;
font-size:16px;
}

.green{
color:green;
font-weight:bold;
}

.red{
color:red;
font-weight:bold;
}

.historyItem{
border-bottom:1px solid #ddd;
padding:8px 0;
}

.smallBtn{
width:auto;
padding:4px 8px;
margin-right:6px;
font-size:12px;
}

</style>
</head>
<body>

<div class="card">

<h2>KPIダッシュボード</h2>

<label>店舗</label>
<select id="store" onchange="loadData()">
<option>足立店</option>
<option>江戸川店</option>
</select>

<label>担当者（フルネーム）</label>
<input id="staff">

<label>生保期間</label>
<select id="period">
<option value="0">未加入</option>
<option value="10">1ヶ月</option>
<option value="15">3ヶ月</option>
<option value="20">6ヶ月</option>
<option value="25">12ヶ月</option>
<option value="30">24ヶ月</option>
<option value="35">36ヶ月</option>
<option value="40">60ヶ月</option>
<option value="50">100ヶ月</option>
</select>

<div class="checkbox">
<input type="checkbox" id="medical">
<label for="medical">医保加入</label>
</div>

<div class="checkbox">
<input type="checkbox" id="premium">
<label for="premium">プレミアム加入</label>
</div>

<div class="checkbox">
<input type="checkbox" id="loan">
<label for="loan">ローン利用</label>
</div>

<div class="checkbox">
<input type="checkbox" id="hospital">
<label for="hospital">病院予約</label>
</div>

<label>付帯金額（円）</label>
<input id="amount">

<button onclick="addOrUpdate()">契約追加</button>

</div>


<div class="card">
<h2>店舗KPI</h2>
<div id="kpi"></div>
</div>


<div class="card">
<h2>履歴</h2>
<div id="history"></div>
</div>


<script>

let editIndex = -1;

function key(){
return "kpi_"+document.getElementById("store").value;
}

function getData(){
return JSON.parse(localStorage.getItem(key()) || "[]");
}

function saveData(data){
localStorage.setItem(key(), JSON.stringify(data));
}

function addOrUpdate(){

let data = getData();

let obj = {

staff:staff.value,
period:Number(period.value),
medical:medical.checked,
premium:premium.checked,
loan:loan.checked,
hospital:hospital.checked,
amount:Number(amount.value)||0

};

if(editIndex==-1){

data.push(obj);

}else{

data[editIndex]=obj;
editIndex=-1;

}

saveData(data);

clearForm();
loadData();

}


function clearForm(){

staff.value="";
period.value="0";
medical.checked=false;
premium.checked=false;
loan.checked=false;
hospital.checked=false;
amount.value="";

}


function editItem(i){

let d=getData()[i];

staff.value=d.staff;
period.value=d.period;
medical.checked=d.medical;
premium.checked=d.premium;
loan.checked=d.loan;
hospital.checked=d.hospital;
amount.value=d.amount;

editIndex=i;

}


function deleteItem(i){

let data=getData();
data.splice(i,1);
saveData(data);
loadData();

}


function loadData(){

let data=getData();

let sales=data.length;

let seihos=data.filter(x=>x.period>0).length;
let seihoRate=sales?((seihos/sales)*100).toFixed(1):0;

let seihoAmountRate=sales?
(data.reduce((a,b)=>a+b.period,0)/sales).toFixed(1):0;

let medicalRate=sales?
((data.filter(x=>x.medical).length/sales)*100).toFixed(1):0;

let avgAmount=sales?
Math.round(data.reduce((a,b)=>a+b.amount,0)/sales):0;

let loanRate=sales?
((data.filter(x=>x.loan).length/sales)*100).toFixed(1):0;

let premiumRate=sales?
((data.filter(x=>x.premium).length/sales)*100).toFixed(1):0;

let hospitalRate=sales?
((data.filter(x=>x.hospital).length/sales)*100).toFixed(1):0;

kpi.innerHTML=`

販売進捗：${sales}/27（残り${27-sales}）

<br><br>

生保加入率：
<span class="${seihoRate>=90?"green":"red"}">
${seihoRate}%
</span>

<br>

生保金額率：
<span class="${seihoAmountRate>=30?"green":"red"}">
${seihoAmountRate}%
</span>

<br>

医保加入率：
<span class="${medicalRate>=90?"green":"red"}">
${medicalRate}%
</span>

<br>

付帯平均：
<span class="${avgAmount>=30000?"green":"red"}">
${avgAmount}円
</span>

<br>

ローン率：
<span class="${loanRate>=25?"green":"red"}">
${loanRate}%
</span>

<br>

プレミアム率：
<span class="${premiumRate>=100?"green":"red"}">
${premiumRate}%
</span>

<br>

病院予約率：
<span class="${hospitalRate>=100?"green":"red"}">
${hospitalRate}%
</span>

`;

history.innerHTML="";

data.forEach((d,i)=>{

history.innerHTML+=`

<div class="historyItem">

${d.staff}

生保:${d.period}%

医保:${d.medical?"〇":"×"}

プレ:${d.premium?"〇":"×"}

ローン:${d.loan?"〇":"×"}

病院:${d.hospital?"〇":"×"}

付帯:${d.amount}円

<br>

<button class="smallBtn" onclick="editItem(${i})">編集</button>

<button class="smallBtn" onclick="deleteItem(${i})">削除</button>

</div>

`;

});

}


loadData();

</script>

</body>
</html>
