<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>KPIダッシュボード</title>

<style>

body{
font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
max-width:520px;
margin:auto;
padding:20px;
background:#f2f4f7;
}

h2{
text-align:center;
margin-bottom:20px;
}

.card{
background:white;
padding:15px;
margin-top:15px;
border-radius:10px;
}

input[type="text"]{
width:100%;
padding:10px;
margin-top:5px;
margin-bottom:10px;
font-size:16px;
}

select{
width:100%;
padding:10px;
margin-bottom:10px;
}

.checkbox-row{
display:flex;
align-items:center;
margin-top:8px;
}

.checkbox-row input{
margin-right:8px;
}

button{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:8px;
background:black;
color:white;
font-size:16px;
}

.danger{
color:red;
font-weight:bold;
}

.safe{
color:green;
font-weight:bold;
}

</style>

</head>

<body>

<h2>KPIダッシュボード</h2>


<div class="card">

<label>店舗</label>

<select id="storeSelect" onchange="changeStore()">
<option value="adachi">足立店</option>
<option value="edogawa">江戸川店</option>
</select>


<label>月</label>

<select id="monthSelect" onchange="changeMonth()">
</select>


<h3>
今月の販売目標頭数：
<span id="targetDisplay">27</span> 頭
</h3>

</div>



<div class="card">

<h3>契約追加</h3>

<input type="text" id="rate" placeholder="生保率(%)">

<input type="text" id="futai" placeholder="付帯金額">


<div class="checkbox-row">
<input type="checkbox" id="premium">
<label>プレミアム加入</label>
</div>

<div class="checkbox-row">
<input type="checkbox" id="iryo">
<label>医保加入</label>
</div>

<div class="checkbox-row">
<input type="checkbox" id="food">
<label>フード定期</label>
</div>

<div class="checkbox-row">
<input type="checkbox" id="hospital">
<label>病院予約</label>
</div>


<button onclick="addContract()">
契約追加
</button>

</div>



<div class="card">

<h3>現在状況</h3>

<div id="status"></div>

</div>



<script>


// 店舗ごとの目標
const storeTargets={

adachi:27,
edogawa:16

};


let currentStore="";
let currentMonth="";
let targetCount=0;


let salesCount=0;
let premiumCount=0;
let iryoCount=0;
let foodCount=0;



// 月初期化
function initMonth(){

const select=
document.getElementById("monthSelect");

select.innerHTML="";

const now=new Date();

for(let i=-2;i<=2;i++){

const d=new Date();
d.setMonth(now.getMonth()+i);

const y=d.getFullYear();
const m=("0"+(d.getMonth()+1)).slice(-2);

const value=y+"-"+m;

const option=document.createElement("option");

option.value=value;
option.text=y+"年"+m+"月";

if(i==0){

option.selected=true;
currentMonth=value;

}

select.appendChild(option);

}

}



// 保存キー（店舗＋月で完全分離）
function getKey(){

return
"kpi_"+
currentStore+
"_"+
currentMonth;

}



// 保存
function saveData(){

const data={

salesCount,
premiumCount,
iryoCount,
foodCount

};

localStorage.setItem(
getKey(),
JSON.stringify(data)
);

}



// 読込
function loadData(){

const saved=
localStorage.getItem(getKey());

if(saved){

const data=
JSON.parse(saved);

salesCount=
data.salesCount||0;

premiumCount=
data.premiumCount||0;

iryoCount=
data.iryoCount||0;

foodCount=
data.foodCount||0;

}else{

salesCount=0;
premiumCount=0;
iryoCount=0;
foodCount=0;

}

updateStatus();

}



// 店舗変更
function changeStore(){

currentStore=
document.getElementById("storeSelect").value;

targetCount=
storeTargets[currentStore];

document.getElementById("targetDisplay").innerText=
targetCount;

loadData();

}



// 月変更
function changeMonth(){

currentMonth=
document.getElementById("monthSelect").value;

loadData();

}



// 契約追加
function addContract(){

salesCount++;

if(document.getElementById("premium").checked)
premiumCount++;

if(document.getElementById("iryo").checked)
iryoCount++;

if(document.getElementById("food").checked)
foodCount++;

saveData();

updateStatus();

}



// 危険判定含む表示
function updateStatus(){

let remain=
targetCount-salesCount;


let premiumRate=
salesCount?
premiumCount/salesCount*100:0;


let iryoRate=
salesCount?
iryoCount/salesCount*100:0;


let foodRate=
salesCount?
foodCount/salesCount*100:0;



// 必要生保率
let needPremium=
remain>0?
((50*(salesCount+remain))-premiumCount)/remain
:0;



let premiumClass=
premiumRate>=50?"safe":"danger";

let iryoClass=
iryoRate>=60?"safe":"danger";

let foodClass=
foodRate>=60?"safe":"danger";



document.getElementById("status").innerHTML=

`
販売頭数：${salesCount} / ${targetCount}
（残り ${remain} 頭）

<br><br>

生保率：
<span class="${premiumClass}">
${premiumRate.toFixed(1)}%
${premiumClass=="danger"?"危険！":"安全"}
</span>

<br>

残り1頭あたり必要生保率：
${needPremium.toFixed(1)}%

<br><br>

医保率：
<span class="${iryoClass}">
${iryoRate.toFixed(1)}%
${iryoClass=="danger"?"危険！":"安全"}
</span>

<br><br>

フード率：
<span class="${foodClass}">
${foodRate.toFixed(1)}%
${foodClass=="danger"?"危険！":"安全"}
</span>

`;

}



// 初期化
initMonth();

currentStore="adachi";

changeStore();


</script>

</body>
</html>
