<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>KPIダッシュボード</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

body{
font-family:sans-serif;
background:#f2f4f7;
padding:15px;
}

.card{
background:white;
padding:15px;
margin-bottom:15px;
border-radius:10px;
}

input,select{
width:100%;
padding:10px;
margin:5px 0 10px 0;
font-size:16px;
}

button{
width:100%;
padding:12px;
background:black;
color:white;
border:none;
border-radius:8px;
font-size:16px;
}

.history{
border-bottom:1px solid #eee;
padding:10px 0;
}

.safe{color:green;font-weight:bold;}
.danger{color:red;font-weight:bold;}

</style>

</head>
<body>

<h2>KPIダッシュボード</h2>

<div class="card">

<label>店舗</label>

<select id="store">
<option value="足立店">足立店</option>
<option value="江戸川店">江戸川店</option>
</select>

<label>担当者</label>

<input id="staff">

<label>生保期間</label>

<select id="months">
<option value="0">未加入</option>
<option value="1">1ヶ月</option>
<option value="3">3ヶ月</option>
<option value="6">6ヶ月</option>
<option value="12">12ヶ月</option>
<option value="24">24ヶ月</option>
<option value="36">36ヶ月</option>
<option value="60">60ヶ月</option>
<option value="100">100ヶ月</option>
</select>

<label>
<input type="checkbox" id="medical"> 医保加入
</label>

<label>
<input type="checkbox" id="premium"> プレミアム加入
</label>

<label>
<input type="checkbox" id="loan"> ローン
</label>

<label>
<input type="checkbox" id="hospital"> 病院予約
</label>

<label>付帯金額</label>

<input id="futai" type="number">

<button onclick="add()">契約追加</button>

</div>

<div class="card">

<h3>店舗KPI</h3>

<div id="kpi"></div>

</div>

<div class="card">

<h3>履歴</h3>

<div id="history"></div>

</div>

<script>

const TARGET={
足立店:27,
江戸川店:16
};

const RATE={
0:0,1:10,3:15,6:20,12:25,24:30,36:35,60:40,100:50
};

function load(){

const key="kpi_"+store.value;

return JSON.parse(localStorage.getItem(key)||"[]");

}

function save(data){

const key="kpi_"+store.value;

localStorage.setItem(key,JSON.stringify(data));

}

function add(){

let data=load();

data.push({

staff:staff.value,

months:Number(months.value),

rate:RATE[months.value],

medical:medical.checked,

premium:premium.checked,

loan:loan.checked,

hospital:hospital.checked,

futai:Number(futai.value)||0,

date:new Date().toLocaleString()

});

save(data);

update();

}

function update(){

let data=load();

let target=TARGET[store.value];

let count=data.length;

let remain=target-count;

let join=data.filter(x=>x.rate>0).length;

let joinRate=count?join/count*100:0;

kpi.innerHTML=`
販売進捗：${count}/${target}（残り${remain}）
<br>
生保加入率：
<span class="${joinRate>=90?"safe":"danger"}">
${joinRate.toFixed(1)}%
</span>
`;

history.innerHTML="";

data.slice().reverse().forEach((x,i)=>{

history.innerHTML+=`
<div class="history">

${x.date}<br>

担当者：${x.staff}<br>

生保：${x.months}ヶ月（${x.rate}%）<br>

医保:${x.medical?"〇":"×"}
プレミアム:${x.premium?"〇":"×"}
ローン:${x.loan?"〇":"×"}
病院:${x.hospital?"〇":"×"}

<br>

付帯:${x.futai}円

</div>
`;

});

}

store.onchange=update;

update();

</script>

</body>
</html>
